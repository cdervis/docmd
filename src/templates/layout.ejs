<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <%- metaTagsHtml || '' %> <%# SEO Plugin Meta Tags %>

    <title><%= pageTitle %> | <%= siteTitle %></title>
    <% if (description && !(metaTagsHtml && metaTagsHtml.includes('name="description"'))) { %>
      <meta name="description" content="<%= description %>">
    <% } %>

    <%- faviconLinkHtml || '' %> <%# Favicon %>

    <link rel="stylesheet" href="<%= relativePathToRoot %>assets/css/docmd-main.css">

    <link rel="stylesheet" href="<%= relativePathToRoot %>assets/css/docmd-highlight-<%= defaultMode === 'dark' ? 'dark' : 'light' %>.css" id="highlight-theme">

    <%- themeCssLinkHtml || '' %> <%# For theme.name specific CSS %>

    <% (customCssFiles || []).forEach(cssFile => { %>
      <link rel="stylesheet" href="<%= relativePathToRoot %><%- cssFile.startsWith('/') ? cssFile.substring(1) : cssFile %>">
    <% }); %>

    <%- pluginStylesHtml || '' %> <%# Plugin specific CSS %>

    <%- pluginHeadScriptsHtml || '' %> <%# Plugin specific head scripts (e.g., Analytics) %>
</head>
<body data-theme="<%= defaultMode %>">
    <aside class="sidebar">
        <div class="sidebar-header">
            <% if (logo && logo.light && logo.dark) { %>
                <a href="<%= logo.href || (relativePathToRoot + 'index.html') %>" class="logo-link">
                    <img src="<%= relativePathToRoot %><%- logo.light.startsWith('/') ? logo.light.substring(1) : logo.light %>" alt="<%= logo.alt || siteTitle %>" class="logo-light" <% if (logo.height) { %>style="height: <%= logo.height %>;"<% } %>>
                    <img src="<%= relativePathToRoot %><%- logo.dark.startsWith('/') ? logo.dark.substring(1) : logo.dark %>" alt="<%= logo.alt || siteTitle %>" class="logo-dark" <% if (logo.height) { %>style="height: <%= logo.height %>;"<% } %>>
                </a>
            <% } else { %>
                <h1><a href="<%= relativePathToRoot %>index.html"><%= siteTitle %></a></h1>
            <% } %>
        </div>
        <%- navigationHtml %>
        <% if (theme && theme.enableModeToggle) { %>
          <button id="theme-toggle-button" aria-label="Toggle theme" class="theme-toggle-button">
            <%# renderIcon is available in the global EJS scope from html-generator %>
            <%- renderIcon('sun', { class: 'icon-sun' }) %>
            <%- renderIcon('moon', { class: 'icon-moon' }) %>
          </button>
        <% } %>
    </aside>
    <div class="main-content-wrapper">
        <header class="page-header">
            <h1><%= pageTitle %></h1>
        </header>
        <main class="content-area">
            <div class="content-layout">
                <div class="main-content">
                    <%- content %>
                    
                    <% if (prevPage || nextPage) { %>
                    <div class="page-navigation">
                        <% if (prevPage) { %>
                        <a href="<%= prevPage.url %>" class="prev-page">
                            <%- renderIcon('arrow-left', { class: 'page-nav-icon' }) %>
                            <span>
                                <small>Previous</small>
                                <strong><%= prevPage.title %></strong>
                            </span>
                        </a>
                        <% } else { %>
                        <div class="prev-page-placeholder"></div>
                        <% } %>
                        
                        <% if (nextPage) { %>
                        <a href="<%= nextPage.url %>" class="next-page">
                            <span>
                                <small>Next</small>
                                <strong><%= nextPage.title %></strong>
                            </span>
                            <%- renderIcon('arrow-right', { class: 'page-nav-icon' }) %>
                        </a>
                        <% } else { %>
                        <div class="next-page-placeholder"></div>
                        <% } %>
                    </div>
                    <% } %>
                </div>
                
                <!-- DEBUG: <%- JSON.stringify({headingsLength: headings ? headings.length : 0}) %> -->
                
                <!-- TOC sidebar -->
                <div class="toc-sidebar">
                    <%- include('toc', { content, headings, navigationHtml, isActivePage }) %>
                </div>
            </div>
        </main>
        <footer class="page-footer">
            <div class="footer-content">
                <div class="user-footer">
                    <%- footerHtml || '' %>
                </div>
                <div class="branding-footer">
                    Build with ðŸ’œ <a href="https://docmd.mgks.dev" target="_blank" rel="noopener">docmd.</a>
                </div>
            </div>
        </footer>
    </div>

    <script src="<%= relativePathToRoot %>assets/js/docmd-theme-toggle.js"></script>
    <% (customJsFiles || []).forEach(jsFile => { %>
      <script src="<%= relativePathToRoot %><%- jsFile.startsWith('/') ? jsFile.substring(1) : jsFile %>"></script>
    <% }); %>

    <%- pluginBodyScriptsHtml || '' %> <%# Plugin specific body scripts %>
</body>
</html>